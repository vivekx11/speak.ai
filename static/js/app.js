class SpeakAI{constructor(){this.chatBox=document.getElementById('chatBox');this.messageInput=document.getElementById('messageInput');this.sendBtn=document.getElementById('sendBtn');this.micBtn=document.getElementById('micBtn');this.language=document.getElementById('language');this.historyModal=document.getElementById('historyModal');this.historyBtn=document.getElementById('historyBtn');this.clearHistoryBtn=document.getElementById('clearHistoryBtn');this.closeBtn=document.querySelector('.close');this.init()}init(){this.sendBtn.addEventListener('click',()=>this.sendMessage());this.messageInput.addEventListener('keypress',(e)=>{if(e.key==='Enter')this.sendMessage()});this.micBtn.addEventListener('click',()=>this.toggleMic());this.historyBtn.addEventListener('click',()=>this.showHistory());this.clearHistoryBtn.addEventListener('click',()=>this.clearHistory());this.closeBtn.addEventListener('click',()=>this.historyModal.style.display='none');window.addEventListener('click',(e)=>{if(e.target==this.historyModal)this.historyModal.style.display='none'})}async sendMessage(){const message=this.messageInput.value.trim();if(!message)return;this.addMessage('user',message);this.messageInput.value='';try{const response=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:message,language:this.language.value})});const data=await response.json();if(response.ok){this.addMessage('ai',data.response);if(data.audio_url){this.playAudio(data.audio_url)}}else{this.addMessage('ai','Error: '+data.error)}}catch(error){console.error('Error:',error);this.addMessage('ai','Connection error. Please try again.')}}addMessage(sender,text){const messageDiv=document.createElement('div');messageDiv.className='message '+sender;const contentDiv=document.createElement('div');contentDiv.className='message-content';contentDiv.textContent=text;messageDiv.appendChild(contentDiv);this.chatBox.appendChild(messageDiv);this.chatBox.scrollTop=this.chatBox.scrollHeight}toggleMic(){this.micBtn.classList.toggle('recording');if(this.micBtn.classList.contains('recording')){this.micBtn.textContent='Recording...';this.startRecording()}else{this.micBtn.textContent='Mic';this.stopRecording()}}startRecording(){console.log('Recording started')}stopRecording(){console.log('Recording stopped')}playAudio(url){const audio=new Audio(url);audio.play()}async showHistory(){try{const response=await fetch('/api/history');const data=await response.json();const historyContent=document.getElementById('historyContent');historyContent.innerHTML='';if(data.history.length===0){historyContent.innerHTML='<p>No conversation history</p>';return}data.history.forEach(item=>{const historyItem=document.createElement('div');historyItem.style.marginBottom='15px';historyItem.style.borderBottom='1px solid #ddd';historyItem.innerHTML=`<strong>You:</strong> ${item.user}<br><strong>AI:</strong> ${item.ai}<br><small>${new Date(item.timestamp).toLocaleString()}</small>`;historyContent.appendChild(historyItem)});this.historyModal.style.display='block'}catch(error){console.error('Error:',error)}}async clearHistory(){if(confirm('Clear history?')){try{await fetch('/api/clear-history',{method:'POST'});this.showHistory()}catch(error){console.error('Error:',error)}}}}document.addEventListener('DOMContentLoaded',()=>{new SpeakAI()});
